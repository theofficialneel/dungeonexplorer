<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface" rel="stylesheet">
	<title>dungeon</title>
	<style type="text/css">
	    body{
	    	background: url("dungbg.jpg");
	    	background-size: cover;
	    }
		#canvas1{
			margin-left: 470px;
			margin-top: 10px;
			border: gold 2px solid;
		}
		.heading{
			font-family: 'Abril Fatface';
			text-align: center;
			color: #bc0707;
			font-size: 50px;
			padding: 0;
		}
        #buttons{
        	margin-left: 46%;
        }
		#timeleft{
			 font-family: 'Abril Fatface';
			 text-align: center;
			 color: gold;
		}
		span{font-family: 'Abril Fatface';
	    }
	</style>
</head>
<body>
   <h1 class="heading">Dungeon Explorer</h1>
   <p id="timeleft"></p>
    <div id="buttons">
   <button id="music" type="button"><span>Mute</span></button>
   <button id="start" type="button"><span>Start</span></button>
    </div>
   <canvas id="canvas1" width="400px" height="400px"></canvas>
   <!--js-->
   <script type="text/javascript">
		var canvas = document.getElementById("canvas1");
  	    var context = canvas.getContext("2d");
  	    window.addEventListener("load",function(){
  	    context.fillStyle = "#bc0707";
  	    context.font = "30px Abril Fatface";
  	    context.fillText("Click Start to Begin!",70,200);});
  	    var fps=60;
  	    //audio js
  	    var audio = new Audio();
  	    audio.src = "Guardians [Action Music].mp3";
  	    window.addEventListener("load",playAudio);
  	    function playAudio(){
  	    	audio.loop = true;
			audio.play();
  	    }
  	    var music = document.getElementById("music");
  	    music.addEventListener("click",funmusic);
  	    function funmusic(){
            if(music.childNodes[0].textContent === "Mute"){
            	audio.pause();
            	music.childNodes[0].textContent = "Music";
            }
            else{
            	audio.play();
            	music.childNodes[0].textContent = "Mute";
            }
		}
		//end of audio js
		var timeleftcounter = 30;
		function timer(){
			var timerElement = document.getElementById("timeleft");
			if(timeleftcounter>=10){
			timerElement.textContent = "Timer Left - 00:"+ timeleftcounter;}
			else {timerElement.textContent = "Timer Left - 00:0"+ timeleftcounter;}
			timeleftcounter--;
			if(timeleftcounter<-1){
				alert("Time Over!");
				document.location.reload();
			}
		}
  	    var tileWidth=40,tileHeight=40;
  	    var mapWidth=20,mapHeight=20;
  	    var map = [
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	        0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,
	        0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0,
	        0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0,
	        0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0,
	        0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,
	        0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0,
	        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0,
	        0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
	        0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0,
	        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0,
	        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0,
	        0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
	        0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
	        0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0,
	        0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
	        0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0,
	        0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0,
	        0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
	        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  	    ];
  	    var viewport = {
  	    	screen : [canvas.width,canvas.height],     //canvas in this case
  	    	startTile : [0,0],  //top left of the camera 
  	    	endTile : [0,0],    //bottom right
  	    	offset : [0,0],     //pixel of the top left from dead point of map
            update : function(playerx,playery){
            	this.offset[0]=Math.floor((this.screen[0]/2)-playerx);
            	this.offset[1]=Math.floor((this.screen[1]/2)-playery);
            	//player x and y are the pixel pos from dead point of map
            	var tileIndex = [
            		Math.floor(playerx/tileWidth),
            		Math.floor(playery/tileHeight)
            	];
              this.startTile[0]=tileIndex[0]-Math.ceil((this.screen[0]/2)/tileWidth)-1;
              this.startTile[1]=tileIndex[1]-Math.ceil((this.screen[1]/2)/tileHeight)-1;
              this.endTile[0]=tileIndex[0]+Math.ceil((this.screen[0]/2)/tileWidth)+1;
              this.endTile[1]=tileIndex[1]+Math.ceil((this.screen[1]/2)/tileHeight)+1;
            }
  	    }
  	    var player = new Character();
  	    function Character(){
  	    	this.tileFrom = [1,1];
  	    	this.tileTo = [1,1];
  	    	this.dimensions = [30,30];  
  	    	this.timeMoved = 0;
  	    	this.position = [45,45]; // in pixel
  	    	this.delayMove = 300;  //time taken to travel bw tiles
  	    }
  	    Character.prototype.placeAt = function(x,y){
  	    	this.tileTo = [x,y];
  	    	this.tileFrom = [x,y];
  	    	this.position = [(tileWidth*x)+(tileWidth-this.dimensions[0])/2,
  	    	                 (tileHeight*y)+(tileHeight-this.dimensions[1])/2];
  	    }
  	    Character.prototype.updateMotion = function(t){  //t is currenttime
  	     if(this.tileFrom[0]==this.tileTo[0]&&this.tileFrom[1]==this.tileTo[1]){return false;}
         if((t-this.timeMoved)>=this.delayMove){    //t-this.timeMoved is the amount of time that has passed since the Character began
         	this.placeAt(this.tileTo[0], this.tileTo[1]);
         }
         else{
		   this.position[0] = (this.tileFrom[0]*tileWidth) + ((tileWidth-this.dimensions[0])/2);
		   this.position[1] = (this.tileFrom[1]*tileHeight) + ((tileHeight-this.dimensions[1])/2);
		   if(this.tileTo[0]!=this.tileFrom[0]){
		   	 var distanceMoved = (tileWidth/this.delayMove)*(t-this.timeMoved);
		   	 if(this.tileTo[0]<this.tileFrom[0]){this.position[0]-=distanceMoved;}
		   	 else {this.position[0]+=distanceMoved;}
		   }
		   if(this.tileTo[1]!=this.tileFrom[1]){
		   	 var distanceMoved = (tileHeight/this.delayMove)*(t-this.timeMoved);
		   	 if(this.tileTo[1]<this.tileFrom[1]){this.position[1]-=distanceMoved;}
		   	 else {this.position[1]+=distanceMoved;}
		   }
         }
         return true;
  	    }
  	    var keyDown = {
  	    	37 : false,
  	    	38 : false,
  	    	39 : false,
  	    	40 : false
  	    };
  	    document.addEventListener("keydown",keyDownHandler);
  	    document.addEventListener("keyup",keyUpHandler);
  	    function keyDownHandler(e){
  	    	if(e.keyCode>=37&&e.keyCode<=40){
  	    		keyDown[e.keyCode]=true;
  	    	}
  	    }
  	    function keyUpHandler(e){
  	    	if(e.keyCode>=37&&e.keyCode<=40){
  	    		keyDown[e.keyCode]=false;
  	    	}
  	    }
  	    function indexCalculation(x,y){
  	    	return (y*mapHeight)+x;
  	    }
  	    function endGameCheck(){
  	    	if(player.tileTo[0]==18&&player.tileTo[1]==16){
  	    		alert("You won!");
  	    		document.location.reload();
  	    	}
  	    }
  	    function Draw(){
  	    	var x,y;
  	    	var currentTime = Date.now();
  	    	if(!player.updateMotion(currentTime)){   
  	    		if(keyDown[38]&&map[indexCalculation(player.tileFrom[0],player.tileFrom[1]-1)]){player.tileTo[1]-=1;}
  	    		else if(keyDown[40]&&map[indexCalculation(player.tileFrom[0],player.tileFrom[1]+1)]){player.tileTo[1]+=1;}
  	    		if(keyDown[37]&&map[indexCalculation(player.tileFrom[0]-1,player.tileFrom[1])]){player.tileTo[0]-=1;}
  	    		else if(keyDown[39]&&map[indexCalculation(player.tileFrom[0]+1,player.tileFrom[1])]){player.tileTo[0]+=1;}
  	    		if(player.tileFrom[0]!=player.tileTo[0]||player.tileFrom[1]!=player.tileTo[1]){player.timeMoved=currentTime;}
  	    	}
  	    	viewport.update(player.position[0]+(player.dimensions[0]/2),
  	    		            player.position[1]+(player.dimensions[1]/2));
  	    	context.fillStyle="black";
  	    	context.fillRect(0,0,canvas.width,canvas.height);
  	    	for(y=0;y<mapHeight;y++)
  	    	{
  	    		for (x=0;x<mapWidth;x++)
                {
                   switch(map[indexCalculation(x,y)]){
                   	 case 0: context.fillStyle = "brown";break;
                   	 case 1: context.fillStyle = "black";
                   }
                   context.fillRect(viewport.offset[0]+x*tileWidth,viewport.offset[1]+y*tileWidth,tileWidth,tileHeight);
                }
  	    	}
  	    	context.fillStyle = "green";
  	    	context.fillRect(viewport.offset[0]+18*tileWidth,viewport.offset[1]+16*tileWidth,tileWidth,tileHeight);
  	    	context.fillStyle = "red";
  	    	context.fillRect(viewport.offset[0]+player.position[0],viewport.offset[1]+player.position[1],player.dimensions[0],player.dimensions[1]);
  	    	endGameCheck();
  	    }
  	    var startButton = document.getElementById("start");
  	    startButton.addEventListener("click",main);
  	    function main(){
  	    setInterval(timer,1000);
  	    setInterval(Draw,1000/fps);
  	    }
	</script>
</body>
</html>